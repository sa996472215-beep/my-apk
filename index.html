<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>â° ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ°ÙƒÙŠØ±</title>
<meta name="theme-color" content="#667eea">
<style>
:root{
  --bg:linear-gradient(135deg,#667eea,#764ba2);
  --card:#ffffff;
  --text:#000;
  --accent:#4CAF50;
  --danger:#f44336;
  --warning:#ff9800;
  --info:#2196F3;
  --primary:#667eea;
}
.dark{
  --bg:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  --card:#1e1e1e;
  --text:#fff;
}

body{
  margin:0;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background:var(--bg);
  color:var(--text);
  direction:rtl;
  min-height:100vh;
  padding:0;
  box-sizing:border-box;
  transition:background 0.3s ease;
}

.topbar{
  background:rgba(0,0,0,.25);
  color:white;
  padding:15px;
  text-align:center;
  font-size:20px;
  font-weight:600;
  position:sticky;
  top:0;
  box-shadow:0 2px 10px rgba(0,0,0,.2);
  z-index:100;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:15px;
}

.toggle{
  background:#000;
  border:none;
  width:38px;
  height:38px;
  border-radius:50%;
  color:#fff;
  cursor:pointer;
  transition:all 0.3s ease;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.toggle:hover{
  transform:rotate(180deg);
  background:#333;
}

.tab-btn{
  background:rgba(255,255,255,0.2);
  border:none;
  color:white;
  padding:8px 15px;
  border-radius:20px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
}

.tab-btn.active{
  background:rgba(255,255,255,0.4);
  transform:scale(1.05);
}

.tab-btn:hover:not(.active){
  background:rgba(255,255,255,0.3);
}

.container{
  max-width:420px;
  margin:20px auto;
  background:var(--card);
  padding:20px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
  transition:all 0.3s ease;
}

.field{
  margin-bottom:15px;
}

.field label{
  display:block;
  font-size:15px;
  margin-bottom:6px;
  font-weight:600;
  color:var(--text);
}

input,textarea,select,button{
  width:100%;
  margin:0;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:15px;
  box-sizing:border-box;
  font-family:inherit;
}

input:focus,textarea:focus,select:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(76, 175, 80, 0.2);
}

button{
  background:var(--accent);
  color:white;
  cursor:pointer;
  transition:.3s;
  margin-top:10px;
  border:none;
  font-weight:600;
  font-size:16px;
  padding:14px;
}
button:hover{transform:scale(1.03); box-shadow:0 4px 15px rgba(0,0,0,.2)}

.record{
  background:var(--info);
  margin-top:0;
}

.record:hover{
  transform:scale(1.03);
}

.item{
  background:rgba(0,0,0,.05);
  padding:14px;
  border-radius:12px;
  margin-top:12px;
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  transition:all 0.3s ease;
  position:relative;
}

.item:hover{
  transform:translateX(5px);
  box-shadow:0 3px 12px rgba(0,0,0,.15);
}

.dark .item{background:rgba(255,255,255,.08)}

.item.done{
  opacity:0.6;
  background:rgba(76, 175, 80, 0.1);
}

.delete{
  background:var(--danger);
  border:none;
  padding:6px 10px;
  color:white;
  border-radius:8px;
  cursor:pointer;
  transition:all 0.2s;
  font-size:16px;
  min-width:36px;
}

.delete:hover{
  background:#d32f2f;
  transform:scale(1.1);
}

.time-display{
  color:#666;
  font-size:13px;
  margin-top:4px;
}

.dark .time-display{
  color:#aaa;
}

.alert{
  padding:12px;
  border-radius:10px;
  margin:10px 0;
  font-size:14px;
  text-align:center;
  font-weight:500;
  animation:slideIn 0.3s ease;
}

@keyframes slideIn{
  from{transform:translateY(-20px); opacity:0}
  to{transform:translateY(0); opacity:1}
}

.alert-success{
  background:rgba(76, 175, 80, 0.2);
  color:#2e7d32;
  border:1px solid #4CAF50;
}

.alert-warning{
  background:rgba(255, 152, 0, 0.2);
  color:#e65100;
  border:1px solid #ff9800;
}

.alert-error{
  background:rgba(244, 67, 54, 0.2);
  color:#c62828;
  border:1px solid #f44336;
}

.recording{
  background:#f44336;
  animation: pulse 1.5s infinite;
}

@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(244, 67, 54, 0.4);}
  70%{box-shadow:0 0 0 10px rgba(244, 67, 54, 0);}
  100%{box-shadow:0 0 0 0 rgba(244, 67, 54, 0);}
}

.ringtones-grid{
  display:grid;
  grid-template-columns:repeat(2, 1fr);
  gap:12px;
  margin-top:10px;
}

.ringtone-item{
  background:rgba(0,0,0,.05);
  border-radius:12px;
  padding:15px 10px;
  text-align:center;
  cursor:pointer;
  transition:all 0.3s;
  border:2px solid transparent;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100px;
}

.dark .ringtone-item{
  background:rgba(255,255,255,.08);
}

.ringtone-item:hover{
  transform:scale(1.03);
  background:rgba(76,175,80,.1);
}

.ringtone-item.selected{
  border-color:var(--accent);
  background:rgba(76,175,80,.15);
  transform:scale(1.05);
  box-shadow:0 0 0 2px var(--accent);
}

.ringtone-item i{
  font-size:28px;
  margin-bottom:8px;
}

.ringtone-item span{
  font-size:13px;
  font-weight:600;
  margin-top:5px;
  display:block;
  min-height:24px;
}

.preview-btn{
  background:var(--info);
  color:white;
  border:none;
  padding:4px 10px;
  border-radius:20px;
  font-size:14px;
  margin-top:5px;
  cursor:pointer;
  transition:all 0.2s;
}

.preview-btn:hover{
  transform:scale(1.1);
  background:#1976d2;
}

.record-section{
  background:rgba(33,150,243,0.1);
  padding:15px;
  border-radius:12px;
  margin-top:15px;
}

.record-section h4{
  margin:0 0 10px 0;
  font-size:16px;
  color:var(--info);
  text-align:center;
}

.or-divider{
  text-align:center;
  margin:20px 0;
  position:relative;
}

.or-divider::before{
  content:'Ø£Ùˆ';
  background:var(--card);
  padding:0 15px;
  position:relative;
  z-index:1;
  font-weight:700;
  color:#666;
  font-size:16px;
}

.or-divider::after{
  content:'';
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:1px;
  background:#ddd;
  z-index:0;
}

.stats{
  display:flex;
  justify-content:space-around;
  margin:15px 0;
  padding:12px;
  background:rgba(0,0,0,.05);
  border-radius:10px;
  font-size:14px;
  font-weight:600;
}

.dark .stats{
  background:rgba(255,255,255,.08);
}

.empty-state{
  text-align:center;
  padding:40px 20px;
  color:#999;
}

.empty-state i{
  font-size:48px;
  display:block;
  margin-bottom:15px;
}

.empty-state p{
  font-size:16px;
  margin:0;
}

.page{
  display:none;
  animation:fadeIn 0.4s ease;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(10px)}
  to{opacity:1; transform:translateY(0)}
}

.page.active{
  display:block;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡Ø§ØªÙ */
@media (max-width:480px){
  .container{
    margin:10px;
    padding:15px;
  }
  
  .topbar{
    padding:12px;
    font-size:18px;
  }
  
  button{
    padding:12px;
    font-size:15px;
  }
  
  .ringtones-grid{
    grid-template-columns:repeat(2, 1fr);
  }
  
  .ringtone-item{
    min-height:90px;
    padding:12px 8px;
  }
  
  .ringtone-item i{
    font-size:24px;
  }
  
  .ringtone-item span{
    font-size:12px;
  }
}
</style>
</head>

<body>

<div class="topbar">
  <button class="toggle" id="modeBtn" onclick="toggleMode()">ğŸŒ™</button>
  <div>
    <button class="tab-btn active" id="tabAdd" onclick="switchTab('add')">â• Ø¥Ø¶Ø§ÙØ©</button>
    <button class="tab-btn" id="tabList" onclick="switchTab('list')">ğŸ“‹ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
  </div>
  <div style="width:38px;"></div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
<div class="page active" id="pageAdd">
  <div class="container">
    <div id="messageContainer"></div>

    <div class="field">
      <label>ğŸ“Œ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
      <input id="title" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯" maxlength="100" autofocus>
    </div>

    <div class="field">
      <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
      <input type="date" id="date" min="">
    </div>

    <div class="field">
      <label>â° Ø§Ù„ÙˆÙ‚Øª</label>
      <input type="time" id="time" min="">
    </div>

    <div class="field">
      <label>ğŸ” Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
      <select id="repeat">
        <option value="none">Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±</option>
        <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
        <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
      </select>
    </div>

    <div class="field">
      <label>ğŸµ Ø§Ø®ØªØ± Ù†ØºÙ…Ø© Ø§Ù„Ù…Ù†Ø¨Ù‡</label>
      <div class="ringtones-grid" id="ringtonesGrid">
        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
      </div>
      
      <div class="or-divider"></div>
      
      <button onclick="document.getElementById('sound').click()" style="background:#9c27b0;margin-top:0;">
        ğŸ“± Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…Ù„ÙØ§Øª Ø¬Ù‡Ø§Ø²ÙŠ
      </button>
      <input type="file" id="sound" accept="audio/*" style="display:none;" onchange="handleFileSelect(this)">
    </div>

    <div class="record-section">
      <h4>ğŸ™ Ø£Ùˆ Ø³Ø¬Ù„ ØªØ°ÙƒÙŠØ±Ùƒ Ø§Ù„ØµÙˆØªÙŠ</h4>
      <button class="record" id="recordBtn" onclick="toggleRecord(this)">ğŸ™ Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div class="field">
      <label>ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="note" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="3"></textarea>
    </div>

    <button class="main-btn" onclick="addReminder()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
  </div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ -->
<div class="page" id="pageList">
  <div class="container">
    <div class="stats" id="stats">
      <span>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯: <strong id="totalReminders">0</strong></span>
      <span>Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <strong id="completedReminders">0</strong></span>
      <span>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <strong id="pendingReminders">0</strong></span>
    </div>

    <div id="list"></div>
  </div>
</div>

<script>
// ============================================
// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
// ============================================
let reminders = JSON.parse(localStorage.getItem("reminders")) || [];
let mode = localStorage.getItem("mode");
let recorder, chunks = [], recordedAudio = null, recording = false;
let selectedRingtone = null;
let isTabActive = true;
let isCheckingMissed = false;
let previewAudio = null;

const modeBtn = document.getElementById("modeBtn");
const title = document.getElementById("title");
const dateInput = document.getElementById("date");
const timeInput = document.getElementById("time");
const noteInput = document.getElementById("note");
const soundInput = document.getElementById("sound");
const repeatSelect = document.getElementById("repeat");
const recordBtn = document.getElementById("recordBtn");
const messageContainer = document.getElementById("messageContainer");
const ringtonesGrid = document.getElementById("ringtonesGrid");
const list = document.getElementById("list");

// ============================================
// Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù„Ø·ÙŠÙØ© (Ø¨Ø¯ÙˆÙ† ØµØ±Ø§Ø®!)
// ============================================
const defaultRingtones = [
  {
    name: "Ø¬Ø±Ø³ Ù„Ø·ÙŠÙ",
    icon: "ğŸ””",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-unlock-simple-notification-2442.mp3"
  },
  {
    name: "ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø§Ø¹Ù…",
    icon: "ğŸµ",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2331.mp3"
  },
  {
    name: "Ù†Ù‚Ø±Ø§Øª Ù‡Ø§Ø¯Ø¦Ø©",
    icon: "ğŸ’§",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-software-interface-click-2330.mp3"
  },
  {
    name: "Ø¬Ø±Ø³ Ø¨Ø§Ø¨",
    icon: "ğŸšª",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-doorbell-tone-2843.mp3"
  },
  {
    name: "Ø¥Ø´Ø¹Ø§Ø¹ Ù‡Ø§Ø¯Ø¦",
    icon: "âœ¨",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-long-pop-notification-2332.mp3"
  },
  {
    name: "Ù†Ù‚Ø±Ø© Ø®ÙÙŠÙØ©",
    icon: "ğŸ”˜",
    url: "https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2439.mp3"
  }
];

// ============================================
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
// ============================================
if(mode === "dark"){
  document.body.classList.add("dark");
  modeBtn.textContent = "â˜€";
}

// ============================================
// Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ Ø§Ù„ØªÙˆÙ‚ÙŠØª)
// ============================================
function formatLocalDateTime(date) {
  return new Date(date.getTime() - date.getTimezoneOffset() * 60000)
    .toISOString()
    .slice(0, 16);
}

// ============================================
// Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ Ù†Øµ Ø¹Ø±Ø¨ÙŠ
// ============================================
function formatDateArabic(date) {
  const options = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  };
  return date.toLocaleDateString('ar-EG', options);
}

// ============================================
// Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
// ============================================
function showMessage(text, type = 'success') {
  if (previewAudio) {
    previewAudio.pause();
    previewAudio = null;
  }
  
  const alertClass = {
    'success': 'alert-success',
    'warning': 'alert-warning',
    'error': 'alert-error'
  };
  
  const messageDiv = document.createElement('div');
  messageDiv.className = `alert ${alertClass[type]}`;
  messageDiv.innerHTML = text;
  
  messageContainer.innerHTML = '';
  messageContainer.appendChild(messageDiv);
  
  setTimeout(() => {
    messageContainer.innerHTML = '';
  }, 5000);
}

// ============================================
// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ
// ============================================
function toggleMode() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  modeBtn.textContent = isDark ? "â˜€" : "ğŸŒ™";
  localStorage.setItem("mode", isDark ? "dark" : "light");
}

// ============================================
// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙØ­Ø§Øª
// ============================================
function switchTab(tab) {
  // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø´Ø·
  if (previewAudio) {
    previewAudio.pause();
    previewAudio = null;
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  if (tab === 'add') {
    document.getElementById('pageAdd').classList.add('active');
    document.getElementById('tabAdd').classList.add('active');
  } else {
    document.getElementById('pageList').classList.add('active');
    document.getElementById('tabList').classList.add('active');
    show(); // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
  }
}

// ============================================
// Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù
// ============================================
function readFile(file) {
  return new Promise((resolve, reject) => {
    if (!file) {
      resolve(null);
      return;
    }
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ============================================
// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
// ============================================
function handleFileSelect(input) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    if (file.size > 5 * 1024 * 1024) { // 5MB
      showMessage("âš ï¸ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB)", 'error');
      input.value = '';
      return;
    }
    
    readFile(file).then(data => {
      selectedRingtone = data;
      // Ø¥Ø²Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      document.querySelectorAll('.ringtone-item').forEach(item => {
        item.classList.remove('selected');
      });
      showMessage(`âœ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${file.name.substring(0, 20)}${file.name.length > 20 ? '...' : ''}`, 'success');
    }).catch(e => {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:", e);
      showMessage("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØª", 'error');
    });
  }
}

// ============================================
// ØªØ´ØºÙŠÙ„ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†ØºÙ…Ø© (Ù…Ø¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
// ============================================
function playPreview(url, element) {
  // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø§Ø¨Ù‚Ø©
  if (previewAudio) {
    previewAudio.pause();
    previewAudio = null;
  }
  
  try {
    previewAudio = new Audio(url);
    previewAudio.volume = 0.7;
    previewAudio.play();
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    const btn = element.querySelector('.preview-btn');
    const originalText = btn.innerHTML;
    btn.innerHTML = 'â¸ï¸';
    
    previewAudio.onended = () => {
      btn.innerHTML = originalText;
      previewAudio = null;
    };
    
    previewAudio.onerror = () => {
      btn.innerHTML = originalText;
      previewAudio = null;
      console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø©:", url);
    };
  } catch (e) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©:", e);
    showMessage("âŒ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø©", 'error');
  }
}

// ============================================
// Ø§Ø®ØªÙŠØ§Ø± Ù†ØºÙ…Ø© Ù…Ù† Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
// ============================================
function selectRingtone(element, url) {
  // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø´Ø·Ø©
  if (previewAudio) {
    previewAudio.pause();
    previewAudio = null;
  }
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
  document.querySelectorAll('.ringtone-item').forEach(item => {
    item.classList.remove('selected');
  });
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø®ØªØ§Ø±
  element.classList.add('selected');
  selectedRingtone = url;
  
  showMessage("âœ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ØºÙ…Ø©: " + element.querySelector('span').textContent, 'success');
}

// ============================================
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù„Ø·ÙŠÙØ©
// ============================================
function loadDefaultRingtones() {
  ringtonesGrid.innerHTML = '';
  
  defaultRingtones.forEach((ringtone, index) => {
    const item = document.createElement('div');
    item.className = 'ringtone-item';
    item.innerHTML = `
      <i>${ringtone.icon}</i>
      <span>${ringtone.name}</span>
      <button class="preview-btn">â–¶ï¸ Ø§Ø³ØªÙ…Ø§Ø¹</button>
    `;
    
    // Ø­Ø¯Ø« Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
    item.querySelector('.preview-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      playPreview(ringtone.url, item);
    });
    
    // Ø­Ø¯Ø« Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    item.addEventListener('click', () => selectRingtone(item, ringtone.url));
    
    ringtonesGrid.appendChild(item);
  });
}

// ============================================
// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
// ============================================
async function toggleRecord(btn) {
  try {
    if (!navigator.mediaDevices || !window.MediaRecorder) {
      showMessage("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª", 'error');
      return;
    }

    if (!recording) {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recorder = new MediaRecorder(stream);
      recorder.start();
      chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recording = true;
      btn.innerText = "â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
      btn.classList.add('recording');
      showMessage("ğŸ¤ ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„... ØªØ­Ø¯Ø« Ø¨ÙˆØ¶ÙˆØ­", 'success');
    } else {
      recorder.stop();
      recorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "audio/webm" });
        recorder.stream.getTracks().forEach(track => track.stop());
        const reader = new FileReader();
        reader.onload = () => {
          recordedAudio = reader.result;
          selectedRingtone = null; // Ù…Ø³Ø­ Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
          // Ø¥Ø²Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          document.querySelectorAll('.ringtone-item').forEach(item => {
            item.classList.remove('selected');
          });
          showMessage("âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­", 'success');
        };
        reader.readAsDataURL(blob);
      };
      recording = false;
      btn.innerText = "ğŸ™ Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¬ÙŠÙ„";
      btn.classList.remove('recording');
    }
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", err);
    showMessage("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + (err.name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"), 'error');
    recording = false;
    recordBtn.innerText = "ğŸ™ Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¬ÙŠÙ„";
    recordBtn.classList.remove('recording');
    if (recorder && recorder.stream) {
      recorder.stream.getTracks().forEach(track => track.stop());
    }
  }
}

// ============================================
// Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯
// ============================================
async function addReminder() {
  if (!title.value.trim()) {
    showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯", 'error');
    title.focus();
    return;
  }

  if (!dateInput.value) {
    showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®", 'error');
    dateInput.focus();
    return;
  }

  if (!timeInput.value) {
    showMessage("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª", 'error');
    timeInput.focus();
    return;
  }

  const now = new Date();
  const selectedDateTime = new Date(dateInput.value + "T" + timeInput.value);
  
  if (selectedDateTime <= now) {
    showMessage("âš ï¸ Ø§Ù„ÙˆÙ‚Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„!", 'error');
    return;
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
  let audioData = null;
  
  if (recordedAudio) {
    audioData = recordedAudio;
  } else if (selectedRingtone) {
    audioData = selectedRingtone;
  }

  reminders.push({
    title: title.value.trim(),
    time: dateInput.value + "T" + timeInput.value,
    note: noteInput.value.trim(),
    sound: audioData,
    repeat: repeatSelect.value,
    done: false,
    id: Date.now()
  });

  try {
    localStorage.setItem("reminders", JSON.stringify(reminders));
    showMessage("âœ“ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­!", 'success');
  } catch (e) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:", e);
    showMessage("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸. Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø©.", 'error');
    return;
  }

  // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  if (audioData) {
    try {
      const audio = new Audio(audioData);
      audio.volume = 0.5;
      audio.play().catch(e => console.log("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†"));
    } catch (e) {
      console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
    }
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
  if ("Notification" in window && Notification.permission === "granted") {
    try {
      new Notification("ğŸ“Œ ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯", {
        body: `${title.value} ÙÙŠ ${timeInput.value}`,
        icon: "https://cdn-icons-png.flaticon.com/512/2910/2910762.png"
      });
    } catch (e) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:", e);
    }
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
  title.value = "";
  noteInput.value = "";
  soundInput.value = "";
  recordedAudio = null;
  selectedRingtone = null;
  recordBtn.innerText = "ğŸ™ Ø§Ø¶ØºØ· Ù„Ù„ØªØ³Ø¬ÙŠÙ„";
  recordBtn.classList.remove('recording');
  
  // Ø¥Ø²Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØºÙ…Ø§Øª
  document.querySelectorAll('.ringtone-item').forEach(item => {
    item.classList.remove('selected');
  });
  
  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†Ø´Ø·Ù‹Ø§
  if (recording) {
    recorder.stop();
    recording = false;
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
  const nowDate = new Date();
  const year = nowDate.getFullYear();
  const month = String(nowDate.getMonth() + 1).padStart(2, '0');
  const day = String(nowDate.getDate()).padStart(2, '0');
  const hours = String(nowDate.getHours()).padStart(2, '0');
  const minutes = String(Math.min(59, nowDate.getMinutes() + 2)).padStart(2, '0'); // +2 Ø¯Ù‚Ø§Ø¦Ù‚
  
  dateInput.value = `${year}-${month}-${day}`;
  timeInput.value = `${hours}:${minutes}`;
}

// ============================================
// Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
// ============================================
function show() {
  const now = new Date();
  let total = 0, completed = 0, pending = 0;
  let html = '';

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  dateInput.min = `${year}-${month}-${day}`;
  
  if (!dateInput.value || dateInput.value < `${year}-${month}-${day}`) {
    dateInput.value = `${year}-${month}-${day}`;
  }

  reminders.sort((a, b) => new Date(a.time) - new Date(b.time));

  reminders.forEach((r, i) => {
    total++;
    const target = new Date(r.time);
    const isDone = r.done || now > target;
    
    if (isDone) completed++;
    else pending++;

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ù‡ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆÙ‚Øª (ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù†Ø´Ø·)
    if (isTabActive && !r.done && now >= target) {
      r.done = true;
      
      if (r.sound) {
        try {
          const audio = new Audio(r.sound);
          audio.volume = 0.8;
          audio.play().catch(e => console.log("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ´ØºÙŠÙ„"));
        } catch (e) {
          console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù…Ù†Ø¨Ù‡:", e);
        }
      }

      if ("Notification" in window && Notification.permission === "granted") {
        try {
          new Notification("â° " + r.title, {
            body: "Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù†! " + (r.note ? "\n" + r.note : ""),
            icon: "https://cdn-icons-png.flaticon.com/512/2910/2910762.png"
          });
        } catch (e) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:", e);
        }
      }

      if (r.repeat !== "none") {
        const next = new Date(target);
        if (r.repeat === "daily") next.setDate(next.getDate() + 1);
        if (r.repeat === "weekly") next.setDate(next.getDate() + 7);
        r.time = formatLocalDateTime(next);
        r.done = false;
      }
      
      try {
        localStorage.setItem("reminders", JSON.stringify(reminders));
      } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:", e);
      }
    }

    html += `
      <div class="item ${r.done ? 'done' : ''}">
        <div style="flex:1; min-width:0;">
          <b>ğŸ“Œ ${r.title}</b><br>
          <span class="time-display">â° ${formatDateArabic(target)}</span><br>
          ${r.note ? `<span style="color:#666; font-size:13px;">ğŸ“ ${r.note}</span>` : ''}
          ${r.repeat !== 'none' ? `<br><span style="color:#2196F3; font-size:12px;">ğŸ” ${r.repeat === 'daily' ? 'ÙŠÙˆÙ…ÙŠ' : 'Ø£Ø³Ø¨ÙˆØ¹ÙŠ'}</span>` : ''}
          ${r.sound ? `<br><span style="color:#4CAF50; font-size:12px;">ğŸµ Ù†ØºÙ…Ø© Ù…Ø®ØµØµØ©</span>` : ''}
        </div>
        <button class="delete" onclick="del(${i})">ğŸ—‘ï¸</button>
      </div>`;
  });

  if (html === '') {
    list.innerHTML = `
      <div class="empty-state">
        <i>ğŸ“­</i>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
        <button class="main-btn" onclick="switchTab('add')" style="background:var(--accent);color:white;border:none;padding:10px 20px;border-radius:10px;margin-top:15px;">
          â• Ø£Ø¶Ù Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø£ÙˆÙ„
        </button>
      </div>`;
  } else {
    list.innerHTML = html;
  }
  
  document.getElementById('totalReminders').textContent = total;
  document.getElementById('completedReminders').textContent = completed;
  document.getElementById('pendingReminders').textContent = pending;
}

// ============================================
// Ø­Ø°Ù ØªØ°ÙƒÙŠØ±
// ============================================
function del(i) {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ")) {
    reminders.splice(i, 1);
    try {
      localStorage.setItem("reminders", JSON.stringify(reminders));
      showMessage("âœ“ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¹Ø¯", 'success');
      if (document.getElementById('pageList').classList.contains('active')) {
        show();
      }
    } catch (e) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:", e);
      showMessage("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù", 'error');
    }
  }
}

// ============================================
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
// ============================================
function checkMissedReminders() {
  if (isCheckingMissed) return;
  isCheckingMissed = true;
  
  const now = new Date();
  const lastCheck = localStorage.getItem("lastCheckTime");
  let missedCount = 0;
  
  if (lastCheck) {
    const lastCheckTime = new Date(lastCheck);
    
    reminders.forEach(r => {
      if (!r.done) {
        const target = new Date(r.time);
        if (target > lastCheckTime && target <= now) {
          missedCount++;
          
          // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ù‡ ÙÙˆØ±Ù‹Ø§
          if (r.sound) {
            try {
              const audio = new Audio(r.sound);
              audio.volume = 0.8;
              audio.play().catch(e => console.log("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ´ØºÙŠÙ„"));
            } catch (e) {
              console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
            }
          }
          
          // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
          if ("Notification" in window && Notification.permission === "granted") {
            try {
              new Notification("â° ÙØ§ØªÙƒ Ù…ÙˆØ¹Ø¯!", {
                body: `ÙØ§ØªÙƒ Ù…ÙˆØ¹Ø¯: ${r.title}\nÙƒØ§Ù† Ù…Ù‚Ø±Ø±Ù‹Ø§ ÙÙŠ: ${formatDateArabic(new Date(r.time))}`,
                icon: "https://cdn-icons-png.flaticon.com/512/2910/2910762.png"
              });
            } catch (e) {
              console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:", e);
            }
          }
          
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
          if (r.repeat !== "none") {
            const next = new Date(target);
            if (r.repeat === "daily") next.setDate(next.getDate() + 1);
            if (r.repeat === "weekly") next.setDate(next.getDate() + 7);
            r.time = formatLocalDateTime(next);
          } else {
            r.done = true;
          }
        }
      }
    });
    
    if (missedCount > 0) {
      localStorage.setItem("reminders", JSON.stringify(reminders));
      setTimeout(() => {
        alert(`âš ï¸ ÙØ§ØªÙƒ ${missedCount} Ù…ÙˆØ¹Ø¯${missedCount > 1 ? 'Ø§Øª' : ''} Ø£Ø«Ù†Ø§Ø¡ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.\nØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.`);
      }, 300);
    }
  }
  
  // Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ
  localStorage.setItem("lastCheckTime", now.toISOString());
  isCheckingMissed = false;
  show();
}

// ============================================
// ÙƒØ´Ù ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨
// ============================================
document.addEventListener('visibilitychange', () => {
  isTabActive = !document.hidden;
  
  if (isTabActive && !isCheckingMissed) {
    setTimeout(checkMissedReminders, 500);
  }
});

// ============================================
// Ø¯Ø§Ù„Ø© Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
// ============================================
async function requestNotificationPermission() {
  if ("Notification" in window) {
    try {
      if (Notification.permission !== "granted" && Notification.permission !== "denied") {
        await Notification.requestPermission();
      }
    } catch (e) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:", e);
    }
  }
}

// ============================================
// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
// ============================================
function init() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(Math.min(59, now.getMinutes() + 2)).padStart(2, '0');
  
  dateInput.value = `${year}-${month}-${day}`;
  timeInput.value = `${hours}:${minutes}`;
  dateInput.min = `${year}-${month}-${day}`;
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØºÙ…Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù„Ø·ÙŠÙØ©
  loadDefaultRingtones();
  
  // Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  requestNotificationPermission();
  
  // ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£ÙˆÙ„
  if (!localStorage.getItem("lastCheckTime")) {
    localStorage.setItem("lastCheckTime", now.toISOString());
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ Ø§Ù„Ø£ÙˆÙ„
  setTimeout(checkMissedReminders, 1000);
  
  // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ (ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©)
  setInterval(() => {
    if (isTabActive) {
      show();
      localStorage.setItem("lastCheckTime", new Date().toISOString());
    }
  }, 1000);
  
  show();
}

// ============================================
// Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
// ============================================
window.addEventListener('beforeunload', (e) => {
  if (recording) {
    e.preventDefault();
    e.returnValue = '';
  }
});

// ============================================
// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
// ============================================
window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
